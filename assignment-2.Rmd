---
title: "EDS231- assignment 2"
authors: "Shane O'Brian, Rosemary Juarez, Liane Chen"
date: "2024-04-11"
output: html_document
---

```{r}
library(tidyverse)
```

This is the almond equation that we need to create the function for:

Y = -0.015T~n,2~ - 0.0046T\^2~n,2~ - 0.07P~1~ + 0.0043P\^2~1~ + 0.28

where:

Y = yield (ton acre \^-1)

T~n,2 = minimum temperatures, where subscript numbers denote month of climate variable (Celsius)~

T~x= maximum temperatures (Celsius)~

P~1 = average monthly precipitation (mm)~

```{r}
#write the function
compute_yield = function(Tn, Tx, P){
  #make sure inputs are numeric
  min_temp = as.numeric(min_temp)
  max_temp = as.numeric(max_temp) #how to incorp?
  precip = as.numeric(precip)
  
  #define variables
  
  
  #define formula
  Y <- -0.015 * (T_min + T_max)/2 - 0.0046((T_min + T_max)/2)^2 - 0.07P1 + 0.0043P^21 + 0.28
}
```

```{r}
# Set your working directory to your home path first
setwd("/Users/lianechen/Documents/5_MEDS/5_Spring_2024/eds230-env-modeling/231-assign-2")

# Read in the climate data
clim_data <- read.table("clim.txt", header = TRUE)

# Display the first few rows of the dataframe
head(clim_data)

# Generate your statistics, with the conceptual model we drew in mind:
calculate_climate_statistics <- function(climate_data) {
 
  # Calculate the minimum and maximum temperature, and total precipitation for each month of each year
  stats <- list(
    MinTemp = aggregate(tmin_c ~ year + month, data = clim_data, FUN = min, na.rm = TRUE),
    MaxTemp = aggregate(tmax_c ~ year + month, data = clim_data, FUN = max, na.rm = TRUE),
    TotalPrecip = aggregate(precip ~ year + month, data = clim_data, FUN = sum, na.rm = TRUE)
  )
  
  # Merge the individual statistics dataframes into one
  climate_stats_df <- Reduce(function(...) merge(..., by = c("year", "month"), all = TRUE), stats)
  
  # Sort the data frame by year and month
  climate_stats_df <- climate_stats_df[order(climate_stats_df$year, climate_stats_df$month), ]
  
  return(climate_stats_df)
}

# Create dataframe with stats
climate_stats_df <- calculate_climate_statistics(clim_data)
print(climate_stats_df)

# Now let's write the function to find mean, min, and max using the conceptual model
calculate_almond_yield <- function(climate_data) {

  # Calculate the min temp for February and total precip for January for each year
  feb_min_temp <- aggregate(tmin_c ~ year, data = climate_data[climate_data$month == 2,], FUN = min)
  jan_precip <- aggregate(precip ~ year, data = climate_data[climate_data$month == 1,], FUN = sum)
  
  # Merge the February minimum temperature and January precipitation data
  yield_data <- merge(feb_min_temp, jan_precip, by = "year")
  
  # Calculate the almond yield anomaly for each year using the formula
  yield_data$almond_yield <- with(yield_data, -0.0157 * tmin_c - 0.00467 * tmin_c^2 - 
                                            0.07 * precip + 0.0043 * precip^2 + 0.28)
  
  # Select the year and the calculated almond yield anomaly
  yield_by_year <- yield_data[, c('year', 'almond_yield')]
  
  return(yield_by_year)
}

#save and print
almond_yield_df <- calculate_almond_yield(clim_data)
print(almond_yield_df)

#find mean yield
mean_almond_yield <- mean(almond_yield_df$almond_yield, na.rm = TRUE)

#Find the max and min yields
max_almond_yield <- max(almond_yield_df$almond_yield, na.rm = TRUE)
min_almond_yield <- min(almond_yield_df$almond_yield, na.rm = TRUE)

#Print the mean, max, and min yield anomolies
print(mean_almond_yield)
print(max_almond_yield)
print(min_almond_yield)
```
